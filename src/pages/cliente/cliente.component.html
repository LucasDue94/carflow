<section class="container grid grid-nogutter p-3 w-full ">
  <p-table #dt class="w-full h-full shadow-1 " [value]="clientes" stripedRows
           size="small"
           [scrollable]="true"
           scrollHeight="flex"
           [virtualScroll]="true"
           [virtualScrollItemSize]="50"
           [loading]="loading"
           [globalFilterFields]="globalFilters"
           [tableStyle]="{ 'min-width': '75rem' }">
    <ng-template #caption>
      <h3 class="session-title m-2 mb-3">Clientesggdgxx</h3>
      <section class="flex justify-content-between  mb-2">
        <p-input-group class="w-13rem">
          <p-inputgroup-addon>
            <i class="pi pi-search"></i>
          </p-inputgroup-addon>
          <input pInputText type="text" [(ngModel)]="searchValue"
                 (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Pesquisa..."/>
        </p-input-group>
        <div>
          <p-button (click)="openModalNovoCliente()" icon="pi pi-plus" class="ml-3 rotate-hover" label="Novo"
                    styleClass="rotate-hover" [rounded]="true"
                    severity="success"/>
        </div>
      </section>
    </ng-template>

    <ng-template #header>
      <tr>
      <!--  <th class="w-min-100 text-center flex justify-content-center" pSortableColumn="id">
          <div class="flex justify-content-center gap-2">
            id
            <p-sortIcon field="id"/>
          </div>
        </th>-->
        <th class="w-min-100" pSortableColumn="cliente.nome">
          <div class="flex items-center gap-2">
            Nome
            <p-sortIcon field="cliente.nome"/>
          </div>
        </th>
        <th class="w-min-150">Telefone</th>
        <th class="w-min-100">Placa</th>
        <th class="w-min-100">Marca/Modelo</th>
        <th class="w-fixed-100" alignFrozen="right" [frozen]="true" pFrozenColumn></th>
      </tr>
    </ng-template>
    <ng-template #body let-cliente>
      <tr>
<!--        <td class="text-center">{{ cliente.id }}</td>-->
        <td>{{ cliente.nome }}</td>
        <td>{{ cliente.telefone | phoneFormat }}</td>
        <td>
          @for (veiculo of cliente.veiculos; track veiculo.id) {
            {{ veiculo.placa }}
          }
        </td>
        <td>
          @for (veiculo of cliente.veiculos; track veiculo.id) {
            {{ veiculo.marca }} {{ veiculo.modelo }}
          }</td>
        <td pFrozenColumn alignFrozen="right" [frozen]="true">
          <p-button icon="pi pi-pencil" (click)="openModalEdicaoCliente(cliente)" [rounded]="true" [text]="true"
                    severity="primary"/>
          <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger"/>
        </td>
      </tr>
    </ng-template>
  </p-table>
</section>

<p-dialog (onHide)="close()" [closable]="true" [closeOnEscape]="true" header="Novo Cliente" [modal]="true"
          [(visible)]="displayModalNovoCliente" [style]="{ width: '40vw' }">
  <app-cliente-form></app-cliente-form>
  <ng-template #footer>
    <button pButton (click)="close()" severity="danger" class="mr-2 ">Cancelar</button>
    <button pButton (click)="salvar()" severity="primary">Salvar</button>
  </ng-template>
</p-dialog>

<p-dialog (onHide)="close()" [closable]="true" [closeOnEscape]="true" header="Editar Cliente" [modal]="true"
          [(visible)]="displayModalEdicaoCliente" [style]="{ width: '40vw' }">
  <app-cliente-form [initialValue]="currentCliente" [isEdit]="true"></app-cliente-form>
  <ng-template #footer>
    <button pButton (click)="close()" severity="danger" class="mr-2 ">Cancelar</button>
    <button pButton (click)="salvar()" severity="primary">Salvar</button>
  </ng-template>
</p-dialog>
